%%%==============================================================================
%% Copyright 2023-present by Alceu Frigeri
%%
%% This work may be distributed and/or modified under the conditions of
%%
%% * The [LaTeX Project Public License](http://www.latex-project.org/lppl.txt),
%%   version 1.3c (or later), and/or
%% * The [GNU Affero General Public License](https://www.gnu.org/licenses/agpl-3.0.html),
%%   version 3 (or later)
%%
%% This work has the LPPL maintenance status *maintained*.
%%
%% The Current Maintainer of this work is Alceu Frigeri
%%
%% This is version {1.9b} {2025/02/14} 
%%
%% The list of files that compose this work can be found in the README.md file at
%% https://ctan.org/pkg/starray
%%
%%%==============================================================================
\NeedsTeXFormat{LaTeX2e}[2023/11/01]
\documentclass[10pt]{article}
\RequirePackage[verbose,a4paper,marginparwidth=27.5mm,top=2.5cm,bottom=1.5cm,hmargin={40mm,20mm},marginparsep=2.5mm,columnsep=10mm,asymmetric]{geometry}
%\RequirePackage[verbose,a4paper,marginparwidth=27.5mm,top=2.5cm,bottom=1.5cm,hmargin={45mm,25mm},marginparsep=2.5mm,columnsep=10mm,asymmetric]{geometry}
\usepackage{codedescribe}
\usepackage{stdemopack}
\RequirePackage[inline]{enumitem}
\SetEnumitemKey{miditemsep}{parsep=0ex,itemsep=0.4ex}

\RequirePackage[hidelinks,hypertexnames=false]{hyperref}
\begin{document}

\setnewcodekey{stdemo}{codeprefix={},resultprefix={},letter={@,_},
  texcs2={
    starray_new,starray_def_from_keyval,
    starray_new_term,starray_get_unique_id,starray_gset_prop,starray_set_prop,
    starray_set_iter_from_hash,starray_get_prop,starray_gset_from_keyval,
    starray_iterate_over
    },
  keywd2={
    NewActivity,ActivitySet,ActivitySetCoord,ActivitySetCoordTitle,
    ActivitySelect,Activity,ActivityCoord,
    ActivityCalendarIterate,
    ActivitySetNewEvent,ActivitySetEventDay
    }
  }

\section{Data Model}\label{DataModel}
As an example, let's define two structures, one to describe/list of ``Activities'' (like a term project, course project, etc.)  and a second one to describe/list the enrolled students (assuming that each enrolled student has one, or more, advisors and a set of reviewers).
\begin{tsremark}
As in any ``procedural language'', one is advised to  carefully design the data model, since this will shape the functions which will set and use said data.
\end{tsremark}
\begin{tsremark}
  Pay attention to the use of the tildes,  \~{} , since those definitions will be made, most likely, in an \tsobj[pkg]{expl3} code r√©gime, one has to remember that spaces are ignored, therefore, if needed, one has to explicitly use a tilde instead of a space.
\end{tsremark}

\subsection{Activity Set}
For the activities one could set an ``starray'' as follow:


\begin{codestore}[activity-def]
\starray_new:n {activity}
\starray_def_from_keyval:nn {activity} {
    name = Activity's~ name ,
    acronym = ACRO ,
    coord . struct =  {
        name = Coordinator's~ name,
        title = Coordinator's~ title ,
      } ,
    calendar . struct = {
        date = {-day-} ,
        week = {-week-} ,
        event = {-event-} ,
      } ,
    chkID = ,        %%% 'unique ID' for checklists
    chkmarked = ,    %%% This shall be a prop list of   marked itens
    chkunmarked = ,  %%% This shall be a prop list of unmarked itens
    chkref = ,       %%% This shall be a prop list of ref      itens
  }
\end{codestore}


\begin{codestore}[student-def]
\starray_new:n {student}
\starray_def_from_keyval:nn {student} {
  self = , %% this shall be self hash (if any)
  first = ,
  last = ,
  name = \rule{\l__stdemo_name_rule_dim}{.1pt} ,
  ID    = \rule{\l__stdemo_ID_rule_dim}{.1pt} , 
  email = \rule{\l__stdemo_email_rule_dim}{.1pt} ,
  worktitle = \rule{\l__stdemo_worktitle_rule_dim}{.1pt} ,
  remarks = ,
  board-local = {~local/place~} ,
  board-date   = {~date~} ,
  board-time  = {~time~} ,
  gradeavrg = 0,
  grade = ,
  flag-null = \c_false_bool , %% IF no grade was given
  flag-graded = \c_false_bool , %%% IF gradeavrg AND finalgrade already calculated (or defined)
  flag-approved = \c_false_bool ,
  flag-coadvisor = \c_false_bool ,
  advisor . struct = {
    first = ,
    last =  ,
    name = \rule{\l__stdemo_name_rule_dim}{.1pt},
    institution = \rule{\l__stdemo_name_rule_dim}{.1pt},
    title = \rule{\l__stdemo_title_rule_dim}{.1pt} ,
    email = \rule{\l__stdemo_email_rule_dim}{.1pt} ,
  } ,
  coadvisor . struct = {
    first = ,
    last =  ,
    name = \rule{\l__stdemo_name_rule_dim}{.1pt},
    institution = \rule{\l__stdemo_name_rule_dim}{.1pt},
    title = \rule{\l__stdemo_title_rule_dim}{.1pt} ,
    email = \rule{\l__stdemo_email_rule_dim}{.1pt} ,
  } ,
  reviewer . struct = {
    first = ,
    last =  ,
    name = \rule{\l__stdemo_name_rule_dim}{.1pt},
    institution = \rule{\l__stdemo_name_rule_dim}{.1pt},
    title = \rule{\l__stdemo_title_rule_dim}{.1pt} ,
    email = \rule{\l__stdemo_email_rule_dim}{.1pt} ,
    pointA = ,
    pointB = ,
    pointC = ,
    pointD = ,
    grade = 0 ,
    flag-set = \c_false_bool , 
  } ,
 }
\end{codestore}





\tscode*[stdemo]{activity-def}


Whereas, the ``coord'' sub-structure is for the activity's coordinator, whilst ``calendar'' shall (for instance) contains a list of calendar events, and, finally, the many ``chk* '' will be used for a ``check list''.

\begin{tsremark}
The ``chkID'' (and checklists). In many cases it's handy to have an unique identifier for a given structure. That can be obtained with \tsobj{\starray_get_unique_ID:nN}, and to avoid calling this function time and time again, one can just store that ID as a field for later use.
\end{tsremark}
\begin{tsremark}
  Could the Coordinator's name and title be a direct property (dismissing the ``coord'' sub-structure)? of course, that's a matter of taste/choice, on how to model it.
\end{tsremark}

\subsection{Student Set}
Similarly, a student's structure might contain, besides student's name, work title, some flags, an advisor (and co-advisor, if needed), reviewer's list (with a provision for reviewer's grade, if needed).

Of course, one doesn't need to define a \tsobj[pkg]{starray} structure using \tsobj{\starray_def_from_keyval:nn}, but, as in this,  if the set of properties is known, it always makes for a cleaner definition.

\begin{tsremark}
  The fields/properties defaults can be anything, including usual \LaTeXe\  commands, like a \tsobj{\rule} which is handy, for instance, when generating forms, e.g., if the fields are all set, a form can be created with the proper values, otherwise, it will be  created with ``rules'' in place (no need to test if the properties were set).
\end{tsremark}

\tscode*[stdemo]{student-def}



\section{Auxiliary Functions}
Once the data layout is set (see \ref{DataModel}) the next step is to define a set of (document level) functions, so the data can be initialized and used by the end user.

\subsection{Activity Functions}

\begin{codestore}[ActivityFunctions]
\tl_new:N \l__stdemo_tmpID_tl
\NewDocumentCommand{\NewActivity}{m} {
    \starray_new_term:nn {activity}{#1}
    \starray_new_term:nn {activity.coord}{}
    \starray_get_unique_id:nNTF {activity} \l__stdemo_tmpID_tl
      {}
      {}
    \starray_gset_prop:nnV {activity}{chkID} \l__stdemo_tmpID_tl
    \prop_new_linked:c {l__stdemo_ \l__stdemo_tmpID_tl _chkmarked_prop}
    \prop_new_linked:c {l__stdemo_ \l__stdemo_tmpID_tl _chkunmarked_prop}
    \prop_new_linked:c {l__stdemo_ \l__stdemo_tmpID_tl _chkref_prop}
}

\NewDocumentCommand{\ActivitySet}{O{}mm} {
  \tl_if_blank:nTF {#1}
    {
      \starray_set_prop:nnn {activity}{name}{#3}
      \starray_set_prop:nnn {activity}{acronym}{#2}
    }
    {
      \starray_set_prop:nnn {activity[#1]}{name}{#3}
      \starray_set_prop:nnn {activity[#1]}{acronym}{#2}
    }
}
\end{codestore}

\begin{codestore}[ActivityFunctions]
\NewDocumentCommand{\ActivitySetCoord}{O{}mO{}}{
  \tl_if_blank:nTF {#1}
    {
      \starray_gset_prop:nnn {activity.coord}{name}{#2}
    }
    {
      \starray_gset_prop:nnn {activity[#1].coord}{name}{#2}
    }
}

\NewDocumentCommand{\ActivitySetCoordTitle}{O{}m} {
  \tl_if_blank:nTF {#1}
    { \starray_set_prop:nnn {activity.coord}{title}{#2} }
    { \starray_set_prop:nnn {activity[#1].coord}{title}{#2} }
}
\end{codestore}

\begin{codestore}[ActivityFunctions]
\NewDocumentCommand{\ActivitySelect}{m}
  { 
    \starray_set_iter_from_hash:nn {activity}{#1} 
  }
\end{codestore}

\begin{codestore}[ActivityFunctions]
\NewDocumentCommand{\Activity}{O{}m}{
  \tl_if_blank:nTF {#1}
    { \starray_get_prop:nn {activity}{#2} }
    { \starray_get_prop:nn {activity[#1]}{#2} }
}

\NewDocumentCommand{\ActivityCoord}{O{}m}{
  \tl_if_blank:nTF {#1}
    { \starray_get_prop:nn {activity.coord}{#2} }
    { \starray_get_prop:nn {activity[#1].coord}{#2} }
}
\end{codestore}

\begin{codestore}[ActivityFunctions]
\NewDocumentCommand{\ActivityCalendarIterate}{m}{
    \starray_iterate_over:nn{activity.calendar}{#1}
}
\end{codestore}


\begin{codestore}[ActivityFunctions] 
\NewDocumentCommand{\ActivitySetNewEvent}{O{}mm}{
  \tl_if_blank:nTF {#1}
    {
      \starray_new_term:nn {activity.calendar}{#2}
      \starray_gset_prop:nnn {activity.calendar}{event}{#3}
    }
    {
      \starray_new_term:nn {activity[#1].calendar}{#2}
      \starray_gset_prop:nnn {activity[#1].calendar}{event}{#3}
    }
}

\NewDocumentCommand{\ActivitySetEventDay}{O{}mmm}{
  \tl_if_blank:nTF {#1}
    {
      \starray_gset_from_keyval:nn {activity.calendar[#2]}
        {
            date = {#3} ,
            week = {#4} ,
        }
    }
    {
      \starray_gset_from_keyval:nn {activity[#1].calendar[#2]}
        {
            date = {#3} ,
            week = {#4} ,
        }
    }
}
\end{codestore}

\begin{codestore}[ActivityUseDemo]
  \NewActivity{FinalWork I}
  \ActivitySet{Final Work I}{FW001}
  
  \NewActivity{FinalWork II}
  
  \NewActivity{InternShip B}
  \ActivitySet{Final Intership}{IN099}
  
  \ActivitySet[FinalWork II]{Final Work II}{FW002}
\end{codestore}


\begin{codestore}[ActivityUseDemo]
  \ActivitySetCoordTitle[FinalWork I]{Prof. }
  \ActivitySetCoord[FinalWork I]{Willian S.}
   
  \ActivitySetCoordTitle[FinalWork II]{Prof. }
  \ActivitySetCoord[FinalWork II]{James S.}

  \ActivitySetCoordTitle[InternShip B]{Dr. }
  \ActivitySetCoord[InternShip B]{Samuel J. }
  
\end{codestore}


One could define a single function to initialize all fields (using a key=val interface), but, in a more traditional approach  one can set two functions to start the initialization process \tsobj{\NewActivity,\ActivitySet}. 
\tscode*[stdemo]{ActivityFunctions}[1]

The idea is to (normally) use one right after the other, though, once created with \tsobj{\NewActivity}, an activity can be initialized/changed at a later point using the optional argument from \tsobj{\ActivitySet}.
\begin{tsremark}
  Every time a \tsobj[pkg]{starray} is instantiated, up to two hashes are created: a numerical one (starting at one) and an ``user defined one''. In the \tsobj{\NewActivity} function above, the given argument is that hash, so the just created instance can be later referenced by it. Of course, it must be an unique ID/hash.
\end{tsremark}
\begin{tsremark}
  One thing to be noticed about \tsobj[pkg]{starrays}: every structure has an associated internal index (iterator). When you create a new instance, this iterator always points to the newly created one, therefore, sparing the use of an explicit index.
\end{tsremark}

%\tscode*[stdemo]{ActivityUseDemo}[1]
%
%~
%
%\tscode*[stdemo]{ActivityUseDemo}[2]

Similarly, one can define some functions to set the activity's coordinator. Of course, it's up to the package programmer to choose if one, two (or more) functions for this.


\tscode*[stdemo]{ActivityFunctions}[2]

And the associated ``Calendar Events'', assuming there will be a fixed set of events (each semester, each year), leaving the date to be set later on. \tsobj{\ActivitySetNewEvent} second parameter  is a hash to reference said event (to be used, for instance, with \tsobj{\ActivitySetEventDay}), and the third parameter is it description.

~

\tscode*[stdemo]{ActivityFunctions}[6]


In many cases, it's desirable to have a ``check list''. Since what such list could entice is always up to debate. So, the idea behind the few next functions is to allow the end user to define which items such a matrix might have.


~

\tscode*[stdemo]{ActivityFunctions}[3]

~

\tscode*[stdemo]{ActivityFunctions}[4]

~

\tscode*[stdemo]{ActivityFunctions}[5]



\end{document} 